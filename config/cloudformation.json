{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Resources": {
    "VPC" : {
       "Type" : "AWS::EC2::VPC",
       "Properties" : {
          "CidrBlock" : "192.168.0.0/16",
          "Tags" : [
            {
              "Key": "Name",
              "Value": "AirlineDemoVPC"
            }
          ]
       }
    },
    "SubnetA" : {
      "Type" : "AWS::EC2::Subnet",
      "Properties" : {
         "AvailabilityZone" : "us-east-1a",
         "CidrBlock" : "192.168.1.0/24",
         "MapPublicIpOnLaunch" : true,
          "Tags" : [
            {
              "Key": "Name",
              "Value": "AirlineDemoSubnetA"
            }
          ],
         "VpcId" : { "Ref" : "VPC" }
      }
    },
    "SubnetB" : {
      "Type" : "AWS::EC2::Subnet",
      "Properties" : {
         "AvailabilityZone" : "us-east-1b",
         "CidrBlock" : "192.168.2.0/24",
         "MapPublicIpOnLaunch" : true,
          "Tags" : [
            {
              "Key": "Name",
              "Value": "AirlineDemoSubnetB"
            }
          ],
         "VpcId" : { "Ref" : "VPC" }
      }
    },
    "SubnetC" : {
      "Type" : "AWS::EC2::Subnet",
      "Properties" : {
         "AvailabilityZone" : "us-east-1c",
         "CidrBlock" : "192.168.3.0/24",
         "MapPublicIpOnLaunch" : true,
          "Tags" : [
            {
              "Key": "Name",
              "Value": "AirlineDemoSubnetC"
            }
          ],
         "VpcId" : { "Ref" : "VPC" }
      }
    },
    "InternetGateway":{
      "Type" : "AWS::EC2::InternetGateway",
      "Properties" : {
        "Tags" : [
          {
            "Key": "Name",
            "Value": "AirlineDemoInternetGateway"
          }
        ]
      }
    },
    "RouteTable" : {
      "Type" : "AWS::EC2::RouteTable",
      "Properties" : {
        "VpcId" : {"Ref": "VPC"},
        "Tags" : [
          {
            "Key": "Name",
            "Value" : "AirlineDemoRouteTable"
          }
        ]
      }
    },
    "RouteToInternet" : {
      "Type" : "AWS::EC2::Route",
      "Properties" : {
        "DestinationCidrBlock" : "0.0.0.0/0",
        "GatewayId" : {"Ref": "InternetGateway"},
        "RouteTableId" : {"Ref":  "RouteTable"}
      },
      "DependsOn": ["VPCGatewayAttachment"]
    },
    "SubnetARouteTableAssociation" : {
      "Type" : "AWS::EC2::SubnetRouteTableAssociation",
      "Properties" : {
         "RouteTableId" : {"Ref" : "RouteTable"},
         "SubnetId" : {"Ref" : "SubnetA"}
      }
    },
    "SubnetBRouteTableAssociation" : {
      "Type" : "AWS::EC2::SubnetRouteTableAssociation",
      "Properties" : {
         "RouteTableId" : {"Ref" : "RouteTable"},
         "SubnetId" : {"Ref" : "SubnetB"}
      }
    },
    "SubnetCRouteTableAssociation" : {
      "Type" : "AWS::EC2::SubnetRouteTableAssociation",
      "Properties" : {
         "RouteTableId" : {"Ref" : "RouteTable"},
         "SubnetId" : {"Ref" : "SubnetC"}
      }
    },
    "VPCGatewayAttachment":{
      "Type" : "AWS::EC2::VPCGatewayAttachment",
      "Properties" : {
         "InternetGatewayId" : {"Ref" : "InternetGateway"  },
         "VpcId" : {"Ref" : "VPC"}
      }
    },
    "SecurityGroup":{
      "Type" : "AWS::EC2::SecurityGroup",
      "Properties" : {
         "GroupDescription" : "AirlineDemoSecurityGroup",
         "VpcId" : {"Ref" : "VPC"},
         "SecurityGroupIngress" : [
            {
              "IpProtocol" : "-1",
               "CidrIp" : { "Fn::GetAtt": ["VPC","CidrBlock"]}
            },
            {
              "IpProtocol" : "tcp",
               "FromPort" : "22",
               "ToPort" : "22",
               "CidrIp" : "0.0.0.0/0"
            },
            {
              "IpProtocol" : "tcp",
               "FromPort" : "10000",
               "ToPort" : "19999",
               "CidrIp" : "0.0.0.0/0"
            }
          ],
          "Tags" : [
            {
              "Key": "Name",
              "Value" : "AirlineDemoSecurityGroup"
            }
          ]
      }

    },
    "gem1101" : {
      "Type" : "AWS::EC2::Instance",
      "Properties" : {
         "AvailabilityZone" : "us-east-1a",
         "EbsOptimized" : true,
         "ImageId" : "ami-0b33d91d",
         "InstanceInitiatedShutdownBehavior" : "stop",
         "InstanceType" : "m4.2xlarge",
         "KeyName" : "lab-keypair",
         "PrivateIpAddress" : "192.168.1.101",
         "SecurityGroupIds" : [ { "Ref" : "SecurityGroup"}],
         "SubnetId" : { "Ref" : "SubnetA" },
         "Tags" : [
            {
              "Key": "Name",
              "Value" : "AirlineDemoServergem1101"
            },
            {
              "Key": "Environment",
              "Value" : "AirlineDemo"
            }
          ],
         "Volumes" : [
          {
            "Device" : "/dev/xvdf",
            "VolumeId" : "vol-08084d1918d445ec3"
          }
,          {
            "Device" : "/dev/xvdg",
            "VolumeId" : "vol-05b0b86ceb32624f9"
          }
,          {
            "Device" : "/dev/xvdh",
            "VolumeId" : "vol-04eabc8016be29e76"
          }
         ] ,
         "BlockDeviceMappings" : [
         ]
      }
    }
,     "gem2101" : {
      "Type" : "AWS::EC2::Instance",
      "Properties" : {
         "AvailabilityZone" : "us-east-1b",
         "EbsOptimized" : true,
         "ImageId" : "ami-0b33d91d",
         "InstanceInitiatedShutdownBehavior" : "stop",
         "InstanceType" : "m4.2xlarge",
         "KeyName" : "lab-keypair",
         "PrivateIpAddress" : "192.168.2.101",
         "SecurityGroupIds" : [ { "Ref" : "SecurityGroup"}],
         "SubnetId" : { "Ref" : "SubnetB" },
         "Tags" : [
            {
              "Key": "Name",
              "Value" : "AirlineDemoServergem2101"
            },
            {
              "Key": "Environment",
              "Value" : "AirlineDemo"
            }
          ],
         "Volumes" : [
          {
            "Device" : "/dev/xvdf",
            "VolumeId" : "vol-07b3d5b50925457d9"
          }
,          {
            "Device" : "/dev/xvdg",
            "VolumeId" : "vol-0ff52e2122fec836a"
          }
,          {
            "Device" : "/dev/xvdh",
            "VolumeId" : "vol-0378d2be1a2eff041"
          }
         ] ,
         "BlockDeviceMappings" : [
         ]
      }
    }
,     "gem3101" : {
      "Type" : "AWS::EC2::Instance",
      "Properties" : {
         "AvailabilityZone" : "us-east-1c",
         "EbsOptimized" : true,
         "ImageId" : "ami-0b33d91d",
         "InstanceInitiatedShutdownBehavior" : "stop",
         "InstanceType" : "m4.2xlarge",
         "KeyName" : "lab-keypair",
         "PrivateIpAddress" : "192.168.3.101",
         "SecurityGroupIds" : [ { "Ref" : "SecurityGroup"}],
         "SubnetId" : { "Ref" : "SubnetC" },
         "Tags" : [
            {
              "Key": "Name",
              "Value" : "AirlineDemoServergem3101"
            },
            {
              "Key": "Environment",
              "Value" : "AirlineDemo"
            }
          ],
         "Volumes" : [
          {
            "Device" : "/dev/xvdf",
            "VolumeId" : "vol-0846e56d94842404b"
          }
,          {
            "Device" : "/dev/xvdg",
            "VolumeId" : "vol-06a05d1607b7bb2f7"
          }
,          {
            "Device" : "/dev/xvdh",
            "VolumeId" : "vol-0152bc703825f62a2"
          }
         ] ,
         "BlockDeviceMappings" : [
         ]
      }
    }
,     "etl2201" : {
      "Type" : "AWS::EC2::Instance",
      "Properties" : {
         "AvailabilityZone" : "us-east-1b",
         "EbsOptimized" : true,
         "ImageId" : "ami-0b33d91d",
         "InstanceInitiatedShutdownBehavior" : "stop",
         "InstanceType" : "m4.2xlarge",
         "KeyName" : "lab-keypair",
         "PrivateIpAddress" : "192.168.2.201",
         "SecurityGroupIds" : [ { "Ref" : "SecurityGroup"}],
         "SubnetId" : { "Ref" : "SubnetB" },
         "Tags" : [
            {
              "Key": "Name",
              "Value" : "AirlineDemoServeretl2201"
            },
            {
              "Key": "Environment",
              "Value" : "AirlineDemo"
            }
          ],
         "Volumes" : [
          {
            "Device" : "/dev/xvdf",
            "VolumeId" : "vol-091ac1e1f0b5a9791"
          }
         ] ,
         "BlockDeviceMappings" : [
         ]
      }
    }
,     "web2201" : {
      "Type" : "AWS::EC2::Instance",
      "Properties" : {
         "AvailabilityZone" : "us-east-1b",
         "EbsOptimized" : true,
         "ImageId" : "ami-0b33d91d",
         "InstanceInitiatedShutdownBehavior" : "stop",
         "InstanceType" : "m4.2xlarge",
         "KeyName" : "lab-keypair",
         "PrivateIpAddress" : "192.168.2.202",
         "SecurityGroupIds" : [ { "Ref" : "SecurityGroup"}],
         "SubnetId" : { "Ref" : "SubnetB" },
         "Tags" : [
            {
              "Key": "Name",
              "Value" : "AirlineDemoServerweb2201"
            },
            {
              "Key": "Environment",
              "Value" : "AirlineDemo"
            }
          ],
         "Volumes" : [
          {
            "Device" : "/dev/xvdf",
            "VolumeId" : "vol-0d6ec4c78d61b0807"
          }
         ] ,
         "BlockDeviceMappings" : [
         ]
      }
    }
,     "controller" : {
      "Type" : "AWS::EC2::Instance",
      "Properties" : {
         "AvailabilityZone" : "us-east-1a",
         "EbsOptimized" : false,
         "ImageId" : "ami-0b33d91d",
         "InstanceInitiatedShutdownBehavior" : "stop",
         "InstanceType" : "t2.micro",
         "KeyName" : "lab-keypair",
         "PrivateIpAddress" : "192.168.1.222",
         "SecurityGroupIds" : [ { "Ref" : "SecurityGroup"}],
         "SubnetId" : { "Ref" : "SubnetA" },
         "Tags" : [
            {
              "Key": "Name",
              "Value" : "AirlineDemoServercontroller"
            },
            {
              "Key": "Environment",
              "Value" : "AirlineDemo"
            }
          ],
         "Volumes" : [
          {
            "Device" : "/dev/xvdf",
            "VolumeId" : "vol-08ae92b9134c3abd3"
          }
         ] ,
         "BlockDeviceMappings" : [
         ]
      }
    }
  },
  "Description": "AirlineDemo Stack"
}